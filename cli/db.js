const path = require('path')
const low = require('lowdb')
const FileAsync = require('lowdb/adapters/FileAsync')

module.exports.ensureDB = async ({ workspace, namespace }) => {
  const file = path.join(workspace, `${namespace}.database.json`)
  const adapter = new FileAsync(file)
  const db = await low(adapter)
  db.defaults({
    _id: '_' + Math.random().toString(36).substr(2, 9),
    IMPORTANT_MSG0: "===== DO NOT EDIT THIS FILE WHEN SERVER IS ACTIVE =====",
    current: {
      effectnode: require('../package.json').version,
      dateCreated: new Date().getTime(),
      db: {}
    },
    versions: [],
    IMPORTANT_MSG1: "===== DO NOT EDIT THIS FILE WHEN SERVER IS ACTIVE ====="
  }).write()
  return db
}
